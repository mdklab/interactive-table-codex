name: Autopilot - Release Train

on:
  schedule:
    - cron: "0 6 * * *"   # daily at 06:00 UTC
  workflow_dispatch:

permissions:
  issues: write
  contents: read

jobs:
  release_candidate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Build release notes draft
        id: notes
        run: |
          echo "notes<<EOF" >> $GITHUB_OUTPUT
          git log --pretty=format:"- %s (%h)" -n 30 >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT

      - name: Open Release Candidate issue
        uses: actions/github-script@v7
        with:
          script: |
            const owner = context.repo.owner;
            const repo = context.repo.repo;
            const notes = `${{ steps.notes.outputs.notes }}`;

            const body = `
## Release Candidate Ready (autogenerated)

### Changes (last 30 commits)
${notes}

### Your decision
Reply with one of:
- ok
- not ok + bullets of what's missing

### If "not ok", use this format
- Missing:
- Fix:
- Nice-to-have:
`;

            const res = await github.rest.issues.create({
              owner, repo,
              title: `Release Candidate - ${new Date().toISOString().slice(0,10)}`,
              body,
              labels: ["status:release-candidate"]
            });

            // TODO: Replace with your GitHub handle
            await github.rest.issues.createComment({
              owner, repo,
              issue_number: res.data.number,
              body: `@YOUR_GITHUB_HANDLE ping — release candidate ready.`
            });
